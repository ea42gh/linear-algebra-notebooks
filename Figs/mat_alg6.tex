\documentclass[notitlepage]{article}
%\pagenumbering{gobble}
\pagestyle{empty}

%\documentclass{standalone}
%\usepackage{standalone}

%\usepackage[french]{babel}
\usepackage{xltxtra}
%\usepackage{xcolor}
\usepackage{nicematrix,tikz}
\usetikzlibrary{calc,fit}


\ExplSyntaxOn
\makeatletter


\dim_new:N \l__submatrix_extra_height_dim
\dim_new:N \l__submatrix_left_xshift_dim
\dim_new:N \l__submatrix_right_xshift_dim

\keys_define:nn { SubMatrix }
  {
    extra-height .dim_set:N = \l__submatrix_extra_height_dim ,
    extra-height .value_required:n = true ,
    left-xshift .dim_set:N = \l__submatrix_left_xshift_dim ,
    left-xshift .value_required:n = true ,
    right-xshift .dim_set:N = \l__submatrix_right_xshift_dim ,
    right-xshift .value_required:n = true ,
  }

\NewDocumentCommand { \SubMatrixOptions } { m }
  { \keys_set:nn { SubMatrix } { #1 } }


\NewDocumentCommand \SubMatrix { m m m m ! O { } }
  {
    \keys_set:nn { SubMatrix } { #5 }
    \begin { tikzpicture }
      [
        outer~sep =0 pt ,
        inner~sep = 0 pt ,
        draw = none ,
        fill = none ,
      ]
    \pgf@process
      {
        \pgfpointdiff
          { \pgfpointanchor { nm - \NiceMatrixLastEnv - #3 - medium } { south } }
          { \pgfpointanchor { nm - \NiceMatrixLastEnv - #2 - medium } { north } }
      }
    \dim_set_eq:NN \l_tmpa_dim \pgf@y
    \dim_add:Nn \l_tmpa_dim \l__submatrix_extra_height_dim
    \node
      at
      (
        [ xshift = -0.8 mm - \l__submatrix_left_xshift_dim ]
        $ (#2-medium.north~west) ! .5 ! (#3-medium.south~east-|#2-medium.north~west) $
      )
      {
        \nullfont
        \c_math_toggle_token
        \left #1
        \vcenter { \nullfont \hrule height .5 \l_tmpa_dim depth .5 \l_tmpa_dim width 0 pt }
        \right .
        \c_math_toggle_token
      } ;
    \node
      at
      (
        [ xshift = 0.8 mm + \l__submatrix_right_xshift_dim ]
        $ (#2-medium.north~west-|#3-medium.south~east) ! .5 ! (#3-medium.south~east) $
      )
      {
        \nullfont
        \c_math_toggle_token
        \left .
        \vcenter { \nullfont \hrule height .5 \l_tmpa_dim depth .5 \l_tmpa_dim width 0 pt }
        \right #4
        \c_math_toggle_token
      } ;
    \end { tikzpicture }
  }

\makeatother
\ExplSyntaxOff


\begin{document}

\newcolumntype{I}{!{\OnlyMainNiceMatrix{\vrule}}}
\SubMatrixOptions{extra-height = 1mm}
\NiceMatrixOptions{cell-space-top-limit = 3pt,cell-space-bottom-limit = 3pt}

\bigskip

$\begin{NiceArray}[create-medium-nodes]{r@{\qquad\ }r@{\qquad\ }}
% --------------------------------------------
  &        \\
  &        \\
  &        \\
  &        \\
  &        \\
  &      C \\  \noalign{\vskip2mm}
B &    B C \\  \noalign{\vskip2mm}
% ----------------------------
A &  A B C  \\
\CodeAfter
% ----------------------------------------- submatrix delimiters
  \SubMatrixOptions{right-xshift=2mm, left-xshift=2mm}
                           \SubMatrix({6-2}{6-2})
    \SubMatrix({7-1}{7-1}) \SubMatrix({7-2}{7-2})
    \SubMatrix({8-1}{8-1}) \SubMatrix({8-2}{8-2})
    % ----------------------------------------- pivot outlines
\end{NiceArray}$ $\qquad \qquad \qquad$
% =====================================================================
$\begin{NiceArray}[create-medium-nodes]{*3r@{\qquad\ }*4r@{\qquad\;\;}r}
% -------------------------------------------- 
  &   &        &  2 & 2 & 1 & 1 & \\
  &   &        & -2 &-1 & 0 & 1 & \\   \noalign{\vskip2mm}
% -----------------------------------
  & 3 & 1      &  4 & 5 & 3 & 2 & \\
  & 0 & 1      & -2 &-1 & 0 &-1 & \\
  & 2 & 2      &  0 & 2 & 2 & 0 & \\   \noalign{\vskip2mm}
% --------------------------------------
1 & 2 & 2      &  0 & 7 & 7 & 0 & \\
2 & 0 & 3      &  8 &16 &12 & 4 &
% -------------------------------------------- 
\CodeAfter
% ----------------------------------------- submatrix delimiters
  \SubMatrixOptions{right-xshift=2mm, left-xshift=2mm}
                           \SubMatrix({1-4}{2-7})
    \SubMatrix({3-2}{5-3}) \SubMatrix({3-4}{5-7})
    \SubMatrix({6-1}{7-3}) \SubMatrix({6-4}{7-7})
\end{NiceArray}$
\end{document}
